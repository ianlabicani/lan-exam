@let takenExamsSig = takenExams();

<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Taken Exams</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Taken Exams</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="ion-padding">
    <!-- Loading State -->
    @if (loading()) {
    <div
      class="ion-text-center"
      style="
        min-height: 240px;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      <div>
        <ion-icon name="hourglass-outline" style="font-size: 48px"></ion-icon>
        <p class="ion-margin-top">Loading exams...</p>
      </div>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <ion-card color="danger">
      <ion-card-content>
        <ion-text color="danger">{{ error() }}</ion-text>
      </ion-card-content>
    </ion-card>
    }

    <!-- Empty State -->
    @if (!loading() && takenExamsSig.length === 0) {
    <ion-card>
      <ion-card-content class="ion-text-center ion-padding">
        <ion-icon name="document-outline" style="font-size: 48px"></ion-icon>
        <h3 class="ion-margin-top">No taken exams yet</h3>
        <p class="ion-margin-top">Start an exam to see your submissions here</p>
      </ion-card-content>
    </ion-card>
    }

    <!-- Exams List -->
    @if (!loading() && takenExamsSig.length > 0) {
    <ion-list>
      @for (takenExam of takenExamsSig; track takenExam.id) {
      <ion-card>
        <!-- Card Header -->
        <ion-card-header>
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: start;
              gap: 12px;
            "
          >
            <ion-card-title style="flex: 1"
              >{{ takenExam.exam.title }}</ion-card-title
            >
            <ion-badge [color]="takenExam.statusColor">
              {{ takenExam.statusLabel }}
            </ion-badge>
          </div>
        </ion-card-header>

        <!-- Card Body -->
        <ion-card-content class="ion-padding">
          <!-- Metadata Grid -->
          <ion-grid>
            <ion-row>
              <ion-col size="6">
                <div class="ion-padding">
                  <p
                    class="ion-text-uppercase"
                    style="font-size: 0.75rem; color: var(--ion-color-medium)"
                  >
                    Exam Points
                  </p>
                  <p style="font-size: 1rem; font-weight: bold">
                    {{ takenExam.exam.total_points }}
                  </p>
                </div>
              </ion-col>
              <ion-col size="6">
                <div class="ion-padding">
                  <p
                    class="ion-text-uppercase"
                    style="font-size: 0.75rem; color: var(--ion-color-medium)"
                  >
                    Your Score
                  </p>
                  <p style="font-size: 1rem; font-weight: bold">
                    {{ takenExam.total_points}}
                  </p>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="6">
                <div class="ion-padding">
                  <p
                    class="ion-text-uppercase"
                    style="font-size: 0.75rem; color: var(--ion-color-medium)"
                  >
                    Percentage
                  </p>
                  <p style="font-size: 1rem; font-weight: bold">
                    @if (takenExam.percentage) { {{ takenExam.percentage }} % }
                    @else { — }
                  </p>
                </div>
              </ion-col>
              <ion-col size="6">
                <div class="ion-padding">
                  <p
                    class="ion-text-uppercase"
                    style="font-size: 0.75rem; color: var(--ion-color-medium)"
                  >
                    Attempt
                  </p>
                  <p style="font-size: 1rem; font-weight: bold">
                    #{{ takenExam.id }}
                  </p>
                </div>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Timeline Info -->
          <ion-item lines="none" class="ion-margin-top">
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            <ion-label>
              <p
                class="ion-text-uppercase"
                style="font-size: 0.75rem; color: var(--ion-color-medium)"
              >
                Started
              </p>
              <p>{{ takenExam.started_at | date: 'MMM dd, yyyy • h:mm a' }}</p>
            </ion-label>
          </ion-item>

          @if (takenExam.submitted_at) {
          <ion-item lines="none">
            <ion-icon
              name="checkmark-circle-outline"
              slot="start"
              color="success"
            ></ion-icon>
            <ion-label>
              <p
                class="ion-text-uppercase"
                style="font-size: 0.75rem; color: var(--ion-color-medium)"
              >
                Submitted
              </p>
              <p>
                {{ takenExam.submitted_at | date: 'MMM dd, yyyy • h:mm a' }}
              </p>
            </ion-label>
          </ion-item>
          }

          <!-- Answers Count -->
          <ion-item lines="none">
            <ion-icon
              name="checkmark-done-outline"
              slot="start"
              color="success"
            ></ion-icon>
            <ion-label>
              <p
                class="ion-text-uppercase"
                style="font-size: 0.75rem; color: var(--ion-color-medium)"
              >
                Answered
              </p>
              <p>
                {{ takenExam.answers_count }} / {{ takenExam.exam.items_count }}
              </p>
            </ion-label>
          </ion-item>

          @if (takenExam.answers_count - takenExam.exam.items_count > 0) {
          <ion-item lines="none">
            <ion-icon
              name="help-circle-outline"
              slot="start"
              color="warning"
            ></ion-icon>
            <ion-label>
              <p
                class="ion-text-uppercase"
                style="font-size: 0.75rem; color: var(--ion-color-medium)"
              >
                Unanswered
              </p>
              <p>{{ takenExam.exam.items_count - takenExam.answers_count }}</p>
            </ion-label>
          </ion-item>
          }
        </ion-card-content>

        <!-- Card Footer -->
        <ion-card-content class="ion-padding-top-none">
          @if (takenExam.submitted_at) {
          <ion-button
            expand="block"
            fill="solid"
            color="dark"
            [routerLink]="['/tabs/taken-exams', takenExam.id]"
          >
            <ion-icon name="eye-outline" slot="start"></ion-icon>
            View Submission
          </ion-button>
          } @else {
          <ion-button
            expand="block"
            fill="solid"
            color="primary"
            [routerLink]="['/tabs/taken-exams', takenExam.id, 'continue']"
          >
            <ion-icon name="arrow-forward-outline" slot="start"></ion-icon>
            Continue Exam
          </ion-button>
          }
        </ion-card-content>
      </ion-card>
      }
    </ion-list>
    }
  </div>
</ion-content>
